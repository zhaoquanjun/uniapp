(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/evidence/index"],{3628:function(e,t,n){"use strict";(function(e){n("e09c");a(n("66fd"));var t=a(n("d4b2"));function a(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,n("543d")["createPage"])},4234:function(e,t,n){"use strict";n.r(t);var a=n("5a78"),i=n.n(a);for(var o in a)"default"!==o&&function(e){n.d(t,e,(function(){return a[e]}))}(o);t["default"]=i.a},"5a78":function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n("3b7d"),i=n("26c2");function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var s=n("537e"),c=getApp(),l=function(){n.e("components/search/search").then(function(){return resolve(n("5fea"))}.bind(null,n)).catch(n.oe)},u=function(){n.e("components/half-screen-dialog/half-screen-dialog").then(function(){return resolve(n("8166"))}.bind(null,n)).catch(n.oe)},r=function(){n.e("components/halfSlideItem/halfSlideItem").then(function(){return resolve(n("933a"))}.bind(null,n)).catch(n.oe)},f={data:function(){return{tabs:[{name:"签署存证",type:"sign"},{name:"数据存证",type:"data"}],signs:[],datas:[],signPageIndex:1,dataPageIndex:1,signTotal:0,dataTotal:0,activeName:"sign",searchParams:"",pageSize:10,isTriggered:!1,activeItme:null,canDownload:"",pdfUrl:""}},components:{search:l,mpHalfScreenDialog:u,halfSlideItem:r},props:{},onLoad:function(){},onShow:function(){var e="sign";this.setData({activeName:e,signPageIndex:1}),this.getPageDataFun(this.activeName,1,this.getPageDataFun("sign"==e?"data":"sign",1))},onReady:function(){this.dialog=this.$refs.mphalfScreenDialog},onHide:function(){this.dialog&&this.dialog.close()},onUnload:function(){c.globalData.activeTab="sign"},onPullDownRefresh:function(){console.log("页面下拉了"),this.getPageDataFun(this.activeName,1)},onShareAppMessage:function(){},methods:{pullDownRefreshFun:function(){var e=this;console.log("容器下拉了"),this.setData({isTriggered:!0,signPageIndex:1,dataPageIndex:1}),this.getPageDataFun(this.activeName,1,(function(){e.setData({isTriggered:!1})}))},changeTabsFun:function(e){this.setData({activeName:e.currentTarget.dataset.name,searchParams:""}),this[this.activeName+"s"].length>0||this.getPageDataFun(this.activeName,1)},getPageDataFun:function(t,n,o){var l=this;if(c.globalData.isLoginIn()){var u=i.certificate_record_list+"?currentPage="+("sign"==t?this.signPageIndex:this.dataPageIndex)+"&pageSize="+this.pageSize+(this.searchParams?"&name="+this.searchParams:"");e.showLoading({title:"加载中..."}),(0,a.get)({url:u,success:function(a){e.hideLoading({}),"function"==typeof o&&setTimeout((function(){o(a)})),a.results&&a.results.length>0&&a.results.map((function(e){return e.gmtModified=s.formatTime(e.gmtModified,"Y-M-D h:m:s")}));var i=[];i=1==n?a.results:l[l.activeName+"s"].concat(a.results),"sign"==t?l.setData({signs:i,signTotal:a.total}):l.setData({datas:i,dataTotal:a.total})}})}},getMoreDataFun:function(){this[this.activeName+"s"].length<this[this.activeName+"Total"]&&(this.setData(o({},this.activeName+"PageIndex",parseInt(this[this.activeName+"PageIndex"])+1)),this.getPageDataFun(this.activeName,2))},changeSearchParamsFun:function(e){this.setData({searchParams:e.detail}),this.getPageDataFun(this.activeName,1)},clearSearchParamsFun:function(){this.setData({searchParams:""}),this.getPageDataFun(this.activeName,1)},viewDetailFun:function(t){var n=t.currentTarget.dataset.id,a=t.currentTarget.dataset.type,i="/evidence/certificateDetail/certificateDetail?id="+n+"&type="+a;e.navigateTo({url:i})},showChainsMenu:function(e){var t=e.currentTarget.dataset.activeitem;this.setData({activeItme:t,canDownload:("1"==t.fileType||"4"==t.fileType)&&2==t.evidenceType}),this.$refs.operate.open()},addChainFromList:function(){this.$refs.operate.close(),e.navigateTo({url:"/pages/contract/contractList/addContractList/addContractList?id="+this.activeItme.id})},previewContractChain:function(t){var n=this;if(1===this.activeItme.status){var a=this.activeItme.hash;if(a){var i=this.activeItme.url;e.showLoading({title:"加载中"}),n.downloadPdfFun(i,1),this.$refs.operate.close()}}},downloadPdfFun:function(t,n){var a=this;e.downloadFile({url:t,success:function(t){e.hideLoading();var i=t.tempFilePath;a.setData({pdfUrl:i}),n&&a.openPdfFun(i)},fail:function(t){e.hideLoading(),console.log(t)},complete:function(e){}})},openPdfFun:function(t){console.log(t),e.openDocument({filePath:t,fileType:"pdf",showMenu:!0,success:function(e){console.log(e,"success")},fail:function(e){console.log(e,"fail")},complete:function(){console.log("complete")}})},handleStartDownloadFun:function(){this.$refs.operate.close(),this.gettingAuth(this.activeItme.filePath)},gettingAuth:function(t){var n=this;e.getSetting({success:function(a){a.authSetting["scope.writePhotosAlbum"]?n.download(t):e.authorize({scope:"scope.writePhotosAlbum",success:function(){n.download(t)},fail:function(){e.openSetting({success:function(){console.log("openSetting success")},fail:function(){console.log("openSetting fail")}})}})},fail:function(e){console.log(e)},complete:function(){console.log("complete")}})},download:function(t){e.showLoading({title:"下载中"});var n=t.slice(t.lastIndexOf(".")+1);e.downloadFile({url:t,success:function(t){console.log(22222),"png"!=n.toLowerCase()&&"jpeg"!=n.toLowerCase()&&"jpg"!=n.toLowerCase()||e.saveImageToPhotosAlbum({filePath:t.tempFilePath,success:function(t){console.log(t,3333),e.hideLoading(),setTimeout((function(){e.showToast({icon:"none",title:"已成功保存到相册"})}),50)},fail:function(t){console.log(t,44444),setTimeout((function(){e.showToast({icon:"none",title:"下载失败"})}),50)}}),"mp4"!=n.toLowerCase()&&"mov"!=n.toLowerCase()&&"avi"!=n.toLowerCase()&&"rmvb"!=n.toLowerCase()&&"flv"!=n.toLowerCase()||e.saveVideoToPhotosAlbum({filePath:t.tempFilePath,success:function(t){console.log(t.errMsg,"下载成功了"),e.hideLoading(),setTimeout((function(){e.showToast({icon:"none",title:"已成功保存到相册"})}),50)},fail:function(t){console.log(t,"失败了"),setTimeout((function(){e.showToast({icon:"none",title:"下载失败"})}),50)}})}})}}};t.default=f}).call(this,n("543d")["default"])},"913e":function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"c",(function(){return o})),n.d(t,"a",(function(){return a}));var a={search:function(){return n.e("components/search/search").then(n.bind(null,"5fea"))},halfSlideItem:function(){return n.e("components/halfSlideItem/halfSlideItem").then(n.bind(null,"933a"))}},i=function(){var e=this,t=e.$createElement;e._self._c},o=[]},9763:function(e,t,n){"use strict";var a=n("f7f5"),i=n.n(a);i.a},d4b2:function(e,t,n){"use strict";n.r(t);var a=n("913e"),i=n("4234");for(var o in i)"default"!==o&&function(e){n.d(t,e,(function(){return i[e]}))}(o);n("9763");var s,c=n("f0c5"),l=Object(c["a"])(i["default"],a["b"],a["c"],!1,null,null,null,!1,a["a"],s);t["default"]=l.exports},f7f5:function(e,t,n){}},[["3628","common/runtime","common/vendor"]]]);