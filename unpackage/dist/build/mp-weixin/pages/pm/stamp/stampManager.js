(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/pm/stamp/stampManager"],{"1bbb":function(t,e,s){"use strict";(function(t){s("e09c");a(s("66fd"));var e=a(s("8c74"));function a(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,s("543d")["createPage"])},2941:function(t,e,s){"use strict";var a;s.d(e,"b",(function(){return n})),s.d(e,"c",(function(){return i})),s.d(e,"a",(function(){return a}));var n=function(){var t=this,e=t.$createElement;t._self._c},i=[]},"4fe4":function(t,e,s){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=s("3b7d"),n=s("1259"),i=s("aa5f"),o=getApp(),c=function(){s.e("components/sliderPicker/sliderPicker").then(function(){return resolve(s("3422"))}.bind(null,s)).catch(s.oe)},u={data:function(){return{isShowAdd:!0,showDialog:!1,stampArray:[],noStampTitle:"暂无印章",noStampContent:"点击下方按钮生成您的印章",isShowListView:!0,isShowNoListView:!1,createSignImageText:"",defaultStamp:null,isSelect:!1,stampLeft:-1,stampTop:-1,currentPage:-1,currentUser:"",selectedItem:"",userList:[],userList1:[],userList2:[],list:[{label:"设为默认",value:"default"},{label:"删除印章",value:"delete"},{label:"取消",value:"cancel"}],curItem:null,curIndex:-1,currentStorage:null}},components:{sliderPicker:c},props:{},onLoad:function(t){null!=t.stampLeft&&this.setData({stampLeft:t.stampLeft,stampTop:t.stampTop,currentPage:t.currentPage});var e="select"==t.style;this.setData({isSelect:e})},onShow:function(){var t=this;this.setData({isShowAdd:!0,userList2:[]}),(0,a.get)({url:i.get_user_info,success:function(e){t.userList2.push(e),t.setData({currentUser:e.name,selectedItem:e}),t.requestStamp()}})},onUnload:function(){},onShareAppMessage:function(){},methods:{requestStamp:function(){var e="",s="";1==this.selectedItem.userType?(console.log("手绘"),e=n.person_painted_list,s="创建手绘签名"):(e=n.company_painted_list,s="创建企业公章"),this.setData({createSignImageText:s});var i=this,c=o.globalData.getUserToken(),u={token:c,"Content-Type":"application/json"};this.selectedItem.companyId&&(u.company_id=this.selectedItem.companyId),console.log(u,this.selectedItem),(0,a.postBody)({url:e,header:u,params:{},success:function(t){console.log(t);for(var e=0;e<t.length;e++)1==t[e].isDefault&&i.setData({defaultStamp:t[e]});i.updateData(t)},fail:function(e){setTimeout((function(){t.showToast({icon:"none",title:e})}),50)},complete:function(){}})},updateData:function(t){var e=0!=t.length;this.setData({stampArray:t,isShowListView:e,isShowNoListView:!e})},addStampAction:function(){"1"==this.selectedItem.userType?t.navigateTo({url:"add/addStamp"}):t.showModal({title:"请到电脑端添加公司印章",confirmText:"取消",showCancel:!1})},toggleDialog:function(){this.setData({showDialog:!this.showDialog})},chooseCompany:function(){var t=this;t.setData({userList1:[]}),(0,a.get)({url:i.companyList,success:function(e){console.log(e),e.data.forEach((function(e){1==e.authStatus&&t.userList1.push(e)})),t.setData({userList:t.userList2.concat(t.userList1)})}}),this.setData({showDialog:!this.showDialog})},switchUser:function(t){var e=t.currentTarget.dataset.item;this.setData({selectedItem:e,isShowAdd:!e.companyId,currentUser:e.companyId?e.companyName:e.name,showDialog:!this.showDialog}),this.requestStamp()},handleShowOperateToolsFun:function(t){if(!this.selectedItem.companyId||this.selectedItem.roleTypes.includes("1")||this.selectedItem.roleTypes.includes("2")){var e=[{label:"设为默认",value:"default"},{label:"删除印章",value:"delete"},{label:"取消",value:"cancel"}];2==t.currentTarget.dataset.item.status&&1!=t.currentTarget.dataset.item.isDefault||(e=e.slice(2)),this.setData({list:e}),this.setData({curItem:t.currentTarget.dataset.item,curIndex:t.currentTarget.dataset.index}),this.$refs.sliderPicker.show()}},handleSelectItemFun:function(t){switch(t.detail){case 0:2==this.curItem.status?this.setDefaultSealFun():this.isShowAdd&&this.deleteStamp();break;case 1:2==this.curItem.status&&this.isShowAdd&&this.deleteStamp();break;default:break}this.$refs.sliderPicker.hide()},setDefaultSealFun:function(){var e=this;t.showLoading({title:"加载中"}),(0,a.put)({url:set_default_seal+"/"+this.curItem.signImageId,success:function(){e.requestStamp(),setTimeout((function(){t.showToast({icon:"none",title:"设置成功"})}),50)},fail:function(e){setTimeout((function(){t.showToast({icon:"none",title:e})}),50)},complete:function(){t.hideLoading()}})},deleteStamp:function(){var e=this;if(1==this.curItem.isDefault)return setTimeout((function(){t.showToast({icon:"none",title:"默认印章不能删除"})}),50),!1;t.showModal({title:"提示",content:"确认删除印章吗？",success:function(s){if(s.confirm){t.showLoading({title:"删除中..."});var i={signImageId:e.curItem.signImageId},c=o.globalData.getUserToken(),u={token:c,"Content-Type":"application/json"};(0,a.post)({url:n.delete_painted_url+"/99?signImageId="+i.signImageId,params:i,header:u,success:function(){var s=e.stampArray;s.splice(e.curIndex,1),e.updateData(s),t.hideLoading(),setTimeout((function(){t.showToast({icon:"none",title:"删除成功"})}),50)},fail:function(e){setTimeout((function(){t.showToast({icon:"none",title:e})}),50)}})}else s.cancel&&console.log("用户点击取消")}})}}};e.default=u}).call(this,s("543d")["default"])},"674e":function(t,e,s){},"7b4c":function(t,e,s){"use strict";s.r(e);var a=s("4fe4"),n=s.n(a);for(var i in a)"default"!==i&&function(t){s.d(e,t,(function(){return a[t]}))}(i);e["default"]=n.a},"7efa":function(t,e,s){"use strict";var a=s("674e"),n=s.n(a);n.a},"8c74":function(t,e,s){"use strict";s.r(e);var a=s("2941"),n=s("7b4c");for(var i in n)"default"!==i&&function(t){s.d(e,t,(function(){return n[t]}))}(i);s("7efa");var o,c=s("f0c5"),u=Object(c["a"])(n["default"],a["b"],a["c"],!1,null,null,null,!1,a["a"],o);e["default"]=u.exports}},[["1bbb","common/runtime","common/vendor"]]]);