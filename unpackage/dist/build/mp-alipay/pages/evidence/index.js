(my["webpackJsonp"]=my["webpackJsonp"]||[]).push([["pages/evidence/index"],{3628:function(e,t,n){"use strict";(function(e){n("e09c");o(n("66fd"));var t=o(n("d4b2"));function o(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,n("c11b")["createPage"])},4234:function(e,t,n){"use strict";n.r(t);var o=n("5a78"),a=n.n(o);for(var i in o)"default"!==i&&function(e){n.d(t,e,(function(){return o[e]}))}(i);t["default"]=a.a},"5a78":function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=n("3b7d"),a=n("26c2"),i=n("537e"),s=getApp(),c=function(){n.e("components/search/search").then(function(){return resolve(n("5fea"))}.bind(null,n)).catch(n.oe)},l=function(){n.e("components/half-screen-dialog/half-screen-dialog").then(function(){return resolve(n("8166"))}.bind(null,n)).catch(n.oe)},u=function(){n.e("components/halfSlideItem/halfSlideItem").then(function(){return resolve(n("933a"))}.bind(null,n)).catch(n.oe)},r={data:function(){return{tabs:[{name:"签署存证",type:"sign"},{name:"数据存证",type:"data"}],signs:[],pageIndex:1,total:0,activeName:"sign",searchParams:"",pageSize:10,isTriggered:!1,activeItme:null,canDownload:"",pdfUrl:""}},components:{search:c,mpHalfScreenDialog:l,halfSlideItem:u},props:{},onLoad:function(){},onShow:function(){this.setData({pageIndex:1}),this.getPageDataFun(1)},onReady:function(){this.dialog=this.$refs.mphalfScreenDialog},onHide:function(){this.dialog&&this.dialog.close()},onUnload:function(){s.globalData.activeTab="sign"},onShareAppMessage:function(){},methods:{pullDownRefreshFun:function(){var e=this;console.log("容器下拉了"),this.setData({isTriggered:!0,pageIndex:1}),this.getPageDataFun(1,(function(){e.setData({isTriggered:!1})}))},getPageDataFun:function(t,n){var c=this;if(s.globalData.isLoginIn()){var l=a.certificate_record_list+"?currentPage="+this.pageIndex+"&pageSize="+this.pageSize+(this.searchParams?"&name="+this.searchParams:"");e.showLoading({title:"加载中..."}),(0,o.get)({url:l,success:function(o){e.hideLoading({}),"function"==typeof n&&setTimeout((function(){n(o)})),o.results&&o.results.length>0&&o.results.map((function(e){return e.gmtModified=i.formatTime(e.gmtModified,"Y-M-D h:m:s")}));var a=1==t?o.results:c.signs.concat(o.results);c.setData({signs:a,total:o.total})}})}},getMoreDataFun:function(){this.signs.length<this.total&&(this.setData({pageIndex:parseInt(this.pageIndex)+1}),this.getPageDataFun(2))},changeSearchParamsFun:function(e){this.setData({searchParams:e.detail}),this.getPageDataFun(1)},clearSearchParamsFun:function(){this.setData({searchParams:""}),this.getPageDataFun(1)},viewDetailFun:function(t){var n=t.currentTarget.dataset.id,o=t.currentTarget.dataset.type,a="/pages/evidence/certificateDetail/certificateDetail?id="+n+"&type="+o;e.navigateTo({url:a})},showChainsMenu:function(e){var t=e.currentTarget.dataset.activeitem;this.setData({activeItme:t,canDownload:("1"==t.fileType||"4"==t.fileType)&&2==t.evidenceType}),this.$refs.operate.open()},addChainFromList:function(){this.$refs.operate.close(),e.navigateTo({url:"/pages/contract/contractList/addContractList/addContractList?id="+this.activeItme.id})},previewContractChain:function(t){var n=this;if(1===this.activeItme.status){var o=this.activeItme.hash;if(o){var a=this.activeItme.url;e.showLoading({title:"加载中"}),n.downloadPdfFun(a,1),this.$refs.operate.close()}}},downloadPdfFun:function(t,n){var o=this;e.downloadFile({url:t,success:function(t){e.hideLoading();var a=t.tempFilePath;o.setData({pdfUrl:a}),n&&o.openPdfFun(a)},fail:function(t){e.hideLoading(),console.log(t)},complete:function(e){}})},openPdfFun:function(t){console.log(t),e.openDocument({filePath:t,fileType:"pdf",showMenu:!0,success:function(e){console.log(e,"success")},fail:function(e){console.log(e,"fail")},complete:function(){console.log("complete")}})},handleStartDownloadFun:function(){this.$refs.operate.close(),this.gettingAuth(this.activeItme.filePath)},gettingAuth:function(t){var n=this;e.getSetting({success:function(o){o.authSetting["scope.writePhotosAlbum"]?n.download(t):e.authorize({scope:"scope.writePhotosAlbum",success:function(){n.download(t)},fail:function(){e.openSetting({success:function(){console.log("openSetting success")},fail:function(){console.log("openSetting fail")}})}})},fail:function(e){console.log(e)},complete:function(){console.log("complete")}})},download:function(t){e.showLoading({title:"下载中"});var n=t.slice(t.lastIndexOf(".")+1);e.downloadFile({url:t,success:function(t){console.log(22222),"png"!=n.toLowerCase()&&"jpeg"!=n.toLowerCase()&&"jpg"!=n.toLowerCase()||e.saveImageToPhotosAlbum({filePath:t.tempFilePath,success:function(t){console.log(t,3333),e.hideLoading(),setTimeout((function(){e.showToast({icon:"none",title:"已成功保存到相册"})}),50)},fail:function(t){console.log(t,44444),setTimeout((function(){e.showToast({icon:"none",title:"下载失败"})}),50)}}),"mp4"!=n.toLowerCase()&&"mov"!=n.toLowerCase()&&"avi"!=n.toLowerCase()&&"rmvb"!=n.toLowerCase()&&"flv"!=n.toLowerCase()||e.saveVideoToPhotosAlbum({filePath:t.tempFilePath,success:function(t){console.log(t.errMsg,"下载成功了"),e.hideLoading(),setTimeout((function(){e.showToast({icon:"none",title:"已成功保存到相册"})}),50)},fail:function(t){console.log(t,"失败了"),setTimeout((function(){e.showToast({icon:"none",title:"下载失败"})}),50)}})}})}}};t.default=r}).call(this,n("c11b")["default"])},"7b8e":function(e,t,n){"use strict";n.d(t,"b",(function(){return a})),n.d(t,"c",(function(){return i})),n.d(t,"a",(function(){return o}));var o={search:function(){return n.e("components/search/search").then(n.bind(null,"5fea"))},halfSlideItem:function(){return n.e("components/halfSlideItem/halfSlideItem").then(n.bind(null,"933a"))}},a=function(){var e=this,t=e.$createElement;e._self._c},i=[]},9763:function(e,t,n){"use strict";var o=n("f7f5"),a=n.n(o);a.a},d4b2:function(e,t,n){"use strict";n.r(t);var o=n("7b8e"),a=n("4234");for(var i in a)"default"!==i&&function(e){n.d(t,e,(function(){return a[e]}))}(i);n("9763");var s,c=n("f0c5"),l=Object(c["a"])(a["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],s);t["default"]=l.exports},f7f5:function(e,t,n){}},[["3628","common/runtime","common/vendor"]]]);