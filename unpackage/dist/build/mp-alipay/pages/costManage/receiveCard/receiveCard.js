(my["webpackJsonp"]=my["webpackJsonp"]||[]).push([["pages/costManage/receiveCard/receiveCard"],{"27ab":function(n,t,e){"use strict";var o=e("7c32"),i=e.n(o);i.a},4777:function(n,t,e){"use strict";e.r(t);var o=e("c288"),i=e("589c");for(var u in i)"default"!==u&&function(n){e.d(t,n,(function(){return i[n]}))}(u);e("27ab");var a,s=e("f0c5"),c=Object(s["a"])(i["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],a);t["default"]=c.exports},"589c":function(n,t,e){"use strict";e.r(t);var o=e("fa3a"),i=e.n(o);for(var u in o)"default"!==u&&function(n){e.d(t,n,(function(){return o[n]}))}(u);t["default"]=i.a},"7c32":function(n,t,e){},c288:function(n,t,e){"use strict";var o;e.d(t,"b",(function(){return i})),e.d(t,"c",(function(){return u})),e.d(t,"a",(function(){return o}));var i=function(){var n=this,t=n.$createElement;n._self._c},u=[]},da0e:function(n,t,e){"use strict";(function(n){e("e09c");o(e("66fd"));var t=o(e("4777"));function o(n){return n&&n.__esModule?n:{default:n}}n(t.default)}).call(this,e("c11b")["createPage"])},fa3a:function(n,t,e){"use strict";(function(n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=e("3b7d"),i=e("730f"),u=e("aa5f"),a=e("537e"),s=getApp(),c={data:function(){return{tel:"",yzm:"",cardId:"",btnWords:"获取验证码",time:60,timer:null,bg:"https://shouyiner-prod.oss-cn-beijing.aliyuncs.com/wxapp/shanqian/cost/receive_card_bg.png",wx_icon:"https://shouyiner-prod.oss-cn-beijing.aliyuncs.com/wxapp/shanqian/cost/wx_logo.png",wxCode:"",openId:"",unionId:"",loginPhone:"",isShowMark:!1,originType:null,isBindOpenId:!0,bandPhone:""}},components:{},props:{},onLoad:function(t){t.gifCardId&&this.setData({cardId:t.gifCardId}),n.getStorageSync("userToken")&&this.getGiftCardStatusFun(this.getGiftCardFun)},onReady:function(){},onShow:function(){},onHide:function(){},onUnload:function(){},onPullDownRefresh:function(){},onReachBottom:function(){},onShareAppMessage:function(){},methods:{handleGetCodeFun:function(){var t=this;return console.log(this.tel),a.isTelCode(this.tel)?this.timer?(setTimeout((function(){n.showToast({icon:"none",title:"验证码已发送，请耐心等待"})}),50),!1):(n.showLoading({title:"获取中"}),void(0,o.get)({url:u.get_register_sms_code_url+"/"+this.tel,success:function(){setTimeout((function(){n.showToast({icon:"none",title:"发送成功,请注意查收"})}),50),t.setData({timer:setInterval((function(){if(t.time>=1){var n=t.time-1;t.setData({time:n,btnWords:n+"s后再次获取"})}else clearInterval(t.timer),t.setData({time:60,timer:null,btnWords:"获取验证码"})}),1e3)})},fail:function(t){setTimeout((function(){n.showToast({title:t,icon:"none"})}),50)},complete:function(){n.hideLoading()}})):(setTimeout((function(){n.showToast({icon:"none",title:"请输入正确手机号"})}),50),!1)},handlePcLoginFun:function(){var t=this;n.showLoading({title:"登录领取中"});var e={phone:this.tel,phoneCode:this.yzm};(0,o.post)({url:u.pc_login,params:e,success:function(e){console.log(e),n.setStorageSync("userToken",e.token),s.globalData.userToken=e.token,t.getGiftCardStatusFun(t.getGiftCardFun)},fail:function(){setTimeout((function(){n.showToast({title:"领取失败",icon:"none"})}),100)}})},loginWxFun:function(t){var e=this;n.login({success:function(o){o.code?(e.setData({wxCode:o.code}),"function"==typeof t&&t()):setTimeout((function(){n.showToast({icon:"none",title:"请先授权微信登陆"})}),50)},fail:function(){setTimeout((function(){n.showToast({icon:"none",title:"请先授权微信登陆"})}),50)}})},handleLoginByPhoneFun:function(){var n=this;this.loginWxFun((function(){n.getUserRegisterInfoFun()}))},getUserRegisterInfoFun:function(){var t=this;(0,o.get)({url:u.get_phone_wx_code+"/"+this.wxCode+"?wxAppType=2",success:function(e){e.isRegister?(t.setData({bandPhone:e.phone,openId:e.openId,unionId:e.unionId,isBindOpenId:!0}),n.navigateTo({url:"/pages/account/loginVerify/loginVerify?phone="+t.bandPhone+"&unionId="+t.unionId+"&openId="+t.openId+"&originType="+t.originType})):(setTimeout((function(){n.showToast({icon:"none",title:"信息获取失败，请授权登录",duration:3e3})}),50),t.setData({isBindOpenId:!1}))},fail:function(e){setTimeout((function(){n.showToast({icon:"none",title:"登陆信息获取失败："+e})}),50),t.setData({isBindOpenId:!1})}})},getPhoneNumber:function(t){var e=this;"getPhoneNumber:ok"==t.detail.errMsg?this.loginWxFun((function(){e.getPhoneFun(t)})):setTimeout((function(){n.showToast({icon:"none",title:"快捷登陆失败"})}),50)},getPhoneFun:function(t){var e=this;(0,o.post)({url:u.decode_phone,params:{encrypted:t.detail.encryptedData,iv:t.detail.iv,code:this.wxCode,wxAppType:2},success:function(t){e.setData({bandPhone:t.phone,loginPhone:t.phone,openId:t.openId,unionId:t.unionId,isShowMark:!0,isBindOpenId:!0}),n.navigateTo({url:"/pages/account/loginVerify/loginVerify?phone="+t.phone+"&unionId="+t.unionId+"&openId="+t.openId+"&isCard=true&cardId="+e.cardId})},fail:function(t){setTimeout((function(){n.showToast({icon:"none",title:t})}),50)}})},handleInputTelFun:function(n){return this.setData({tel:n.detail.value}),n.detail.value},handleInputYzmFun:function(n){return this.setData({yzm:n.detail.value}),n.detail.value},getGiftCardFun:function(){n.showLoading({title:"领取中"}),(0,o.get)({url:i.get_gift_card_from_wx+this.cardId,success:function(t){setTimeout((function(){n.showToast({icon:"none",title:"礼品卡领取成功"})}),50),setTimeout((function(){n.redirectTo({url:"/pages/costManage/accountCard/accountCard?type=1"})}),2500)},fail:function(t){console.log(t),setTimeout((function(){n.showToast({icon:"none",title:t})}),50)},complete:function(){n.hideLoading()}})},getGiftCardStatusFun:function(t){(0,o.get)({url:i.get_gift_card_status+this.cardId,success:function(e){console.log(e),e?"function"==typeof t&&t():(setTimeout((function(){n.showToast({icon:"none",title:"礼品卡已被领取"})}),50),setTimeout((function(){n.switchTab({url:"/pages/home/home"})}),1500))},fail:function(t){setTimeout((function(){n.showToast({icon:"none",title:t})}),50),setTimeout((function(){n.switchTab({url:"/pages/home/home"})}),1500)}})}}};t.default=c}).call(this,e("c11b")["default"])}},[["da0e","common/runtime","common/vendor"]]]);