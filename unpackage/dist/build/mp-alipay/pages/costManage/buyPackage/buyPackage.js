(my["webpackJsonp"]=my["webpackJsonp"]||[]).push([["pages/costManage/buyPackage/buyPackage"],{1118:function(t,e,a){"use strict";(function(t){a("e09c");c(a("66fd"));var e=c(a("5e73"));function c(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,a("c11b")["createPage"])},4198:function(t,e,a){"use strict";var c;a.d(e,"b",(function(){return n})),a.d(e,"c",(function(){return o})),a.d(e,"a",(function(){return c}));var n=function(){var t=this,e=t.$createElement;t._self._c},o=[]},"5e73":function(t,e,a){"use strict";a.r(e);var c=a("4198"),n=a("afb1");for(var o in n)"default"!==o&&function(t){a.d(e,t,(function(){return n[t]}))}(o);a("794c");var u,i=a("f0c5"),r=Object(i["a"])(n["default"],c["b"],c["c"],!1,null,null,null,!1,c["a"],u);e["default"]=r.exports},"6b17":function(t,e,a){},"794c":function(t,e,a){"use strict";var c=a("6b17"),n=a.n(c);n.a},afb1:function(t,e,a){"use strict";a.r(e);var c=a("ef82"),n=a.n(c);for(var o in c)"default"!==o&&function(t){a.d(e,t,(function(){return c[t]}))}(o);e["default"]=n.a},ef82:function(t,e,a){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var c=a("3b7d"),n=a("730f"),o={data:function(){return{packages:[],accountInfo:{card:0,account:0},payInfo:{card:0,account:0,third:0},checkedStatus:{card:!0,account:!0,third:!1},packageId:"",selectWays:["card","account"],activeIndex:0,rechargeValue:100,total:Number(100).toFixed(2),timer:null}},onShow:function(){this._getPackagesList()},methods:{_setCanNextValue:function(){var t=!1;t=!(0==this.total||Number(this.payInfo.card)+Number(this.payInfo.account)+Number(this.payInfo.third)<this.rechargeValue),console.log(t),this.setData({canNext:t})},_getAccountAndCardInfo:function(){var e=this;(0,c.get)({url:n.get_account_and_card_info,success:function(t){var a={card:0,account:0,third:0};t.couponBalance&&t.couponBalance>0&&(a.card=t.couponBalance>e.rechargeValue?e.rechargeValue:t.couponBalance),!t.couponBalance&&t.expenseBalance>0&&(a.account=t.expenseBalance>e.rechargeValue?e.rechargeValue:t.expenseBalance),e.setData({accountInfo:{card:(t.couponBalance/100).toFixed(2),account:(t.expenseBalance/100).toFixed(2)},payInfo:a}),e._setCanNextValue()},fail:function(e){setTimeout((function(){t.showToast({icon:"none",title:e})}),50)}})},_getPackagesList:function(){var e=this;(0,c.get)({url:n.get_package_list,success:function(t){t=t.filter((function(t){return t.price/100<=1e3})),t.map((function(t){t.price&&(t.price=(t.price/100).toFixed(2)),t.originPrice&&(t.originPrice=(t.originPrice/100).toFixed(2))}));var a=JSON.parse(JSON.stringify(t[0]));a.price=.01,t.push(a),e.setData({packages:t,rechargeValue:t[0].price,total:t[0].price,packageId:t[0].id}),e._getAccountAndCardInfo()},fail:function(e){setTimeout((function(){t.showToast({icon:"none",title:e})}),50)}})},handleChangeSelectStatus:function(t){this.setData({selectWays:t.detail.value}),this._setCheckedStatus(),this._setPaymentAmount()},_handleSelectValue:function(t){this.setData({rechargeValue:t.price,total:t.price,packageId:t.id}),this._setPaymentAmount()},_setCheckedStatus:function(){var t=JSON.parse(JSON.stringify(this.checkedStatus));t.card=!!this.selectWays.some((function(t){return"card"==t})),t.account=!!this.selectWays.some((function(t){return"account"==t})),t.third=!!this.selectWays.some((function(t){return"third"==t})),this.setData({checkedStatus:t})},_setPaymentAmount:function(){var t={card:0,account:0,third:0};this.selectWays.some((function(t){return"card"==t}))&&(Number(this.accountInfo.card)>Number(this.rechargeValue)?t.card=this.rechargeValue:t.card=this.accountInfo.card),this.selectWays.some((function(t){return"account"==t}))&&(this.selectWays.some((function(t){return"card"==t}))?Number(this.rechargeValue)>Number(this.accountInfo.card)&&(t.account=Number(this.rechargeValue)-Number(this.accountInfo.card)>Number(this.accountInfo.account)?Number(this.accountInfo.account):Number(this.rechargeValue)-Number(this.accountInfo.card)):t.account=Number(this.accountInfo.account)>Number(this.rechargeValue)?Number(this.rechargeValue):Number(this.accountInfo.account)),this.selectWays.some((function(t){return"third"==t}))&&(t.third=this.rechargeValue,this.selectWays.some((function(t){return"card"==t}))&&(Number(this.accountInfo.card)>=Number(this.rechargeValue)?t.third=0:t.third=Number(this.rechargeValue)-Number(this.accountInfo.card)),this.selectWays.some((function(t){return"account"==t}))&&(Number(this.accountInfo.account)+Number(this.accountInfo.card)>=Number(this.rechargeValue)?t.third=0:t.third=Number(this.rechargeValue)-Number(this.accountInfo.account))),this.setData({payInfo:t}),this._setCanNextValue()},_handleConfirmBuy:function(){this.canNext&&(t.showLoading({title:"支付中"}),this.selectWays.some((function(t){return"third"==t}))&&Number(this.payInfo.third)>0?this._getZfbPayParams():this._accountPayForPackage())},_accountPayForPackage:function(){var e={accountPay:this.selectWays.some((function(t){return"card"==t})),contractSetMealId:this.packageId,couponPay:this.selectWays.some((function(t){return"account"==t})),thirdPay:this.selectWays.some((function(t){return"third"==t}))};(0,c.postBody)({url:n.buy_package,params:e,success:function(){setTimeout((function(){t.showToast({icon:"none",title:"套餐购买成功，可返回费用管理查看"})}),50),setTimeout((function(){t.redirectTo({url:"/pages/costManage/costManage"})}),2e3)},fail:function(e){setTimeout((function(){t.showToast({icon:"none",title:e})}),50)}})},_getWxPayParams:function(){var e=this;t.showLoading({title:"创建订单中"}),(0,c.get)({url:n.get_wx_pay_params+"?amount="+this.total+"&body=微信支付&rechargeType=1",success:function(t){console.log(t),e._payByWx(t)},fail:function(e){setTimeout((function(){t.showToast({icon:"none",title:e})}),50)},complete:function(){t.hideLoading()}})},_getZfbPayParams:function(){var e=this;t.showLoading({title:"创建订单中"}),(0,c.get)({url:n.get_wx_pay_params+"?amount="+this.total+"&body=支付宝支付&rechargeType=1",success:function(t){console.log(t),e._payByZfb(t)},fail:function(e){setTimeout((function(){t.showToast({icon:"none",title:e})}),50)},complete:function(){t.hideLoading()}})},_payByWx:function(e){var a=this;this.rechargeValue&&t.requestPayment({timeStamp:e.timeStamp,nonceStr:e.nonceStr,package:e.package,signType:e.signType,paySign:e.paySign,success:function(){a._accountPayForPackage()},fail:function(e){t.showToast({icon:"none",title:e})},complete:function(){}})},_payByZfb:function(e){var a=this;this.rechargeValue&&my.tradePay({tradeNO:e,success:function(){a._accountPayForPackage()},fail:function(e){t.showToast({icon:"none",title:e})}})}}};e.default=o}).call(this,a("c11b")["default"])}},[["1118","common/runtime","common/vendor"]]]);