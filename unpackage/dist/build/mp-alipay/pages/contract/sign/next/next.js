(my["webpackJsonp"]=my["webpackJsonp"]||[]).push([["pages/contract/sign/next/next"],{"3e6e":function(e,n,t){"use strict";(function(e){t("e09c");a(t("66fd"));var n=a(t("d5fb"));function a(e){return e&&e.__esModule?e:{default:e}}e(n.default)}).call(this,t("c11b")["createPage"])},"4ae5":function(e,n,t){"use strict";var a;t.d(n,"b",(function(){return s})),t.d(n,"c",(function(){return o})),t.d(n,"a",(function(){return a}));var s=function(){var e=this,n=e.$createElement;e._self._c},o=[]},"67ac":function(e,n,t){},d5fb:function(e,n,t){"use strict";t.r(n);var a=t("4ae5"),s=t("f552");for(var o in s)"default"!==o&&function(e){t.d(n,e,(function(){return s[e]}))}(o);t("f628");var i,r=t("f0c5"),c=Object(r["a"])(s["default"],a["b"],a["c"],!1,null,null,null,!1,a["a"],i);n["default"]=c.exports},db5d:function(e,n,t){"use strict";(function(e){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var a=t("3b7d"),s=t("5746"),o=t("aa5f"),i=function(){t.e("components/avatar/avatar").then(function(){return resolve(t("1537"))}.bind(null,t)).catch(t.oe)},r=function(){Promise.all([t.e("common/vendor"),t.e("miniprogram_npm/vant-weapp/datetime-picker/index")]).then(function(){return resolve(t("95f3"))}.bind(null,t)).catch(t.oe)},c={data:function(){return{currentDate:"",ishighLight:!1,isSign:!1,isLink:!1,isSort:!1,userOrder:0,signingDeadline:"",fileTermination:"",showCopy:!1,copyItem:{top:0,companyName:"",userName:"",userPhone:"",chapter:"",signType:"",personAuth:"",companyAuth:""},replace:{companyName:"",userName:"",userPhone:"",chapter:"",signType:"",personAuth:"",companyAuth:""},signMans:[],linkMans:[],startX:0,startY:0,contractId:""}},components:{avatar:i,vanDatetimePicker:r},props:{},onLoad:function(n){var t=e.getStorageSync("signMans")?e.getStorageSync("signMans"):[],a=e.getStorageSync("linkMans")?e.getStorageSync("linkMans"):[],s=e.getStorageSync("currentUser"),o=n.isdraft;if(this.setData({contractId:n.contractId}),o)this.getDetailDataFun(n.contractId);else{var i={userName:e.getStorageSync("userName"),userPhone:e.getStorageSync("userAccount"),isPersonAuth:!0,processType:2,status:1};s.companyId?(i.companyName=s.companyName,i.isCompanyAuth=!0,i.sealName="企业章，法人代表章",i.sealType=[2,3].join(),i.relationType=2):(i.sealName="手绘章，个人模版章",i.sealType=[1,4].join(),i.relationType=1);var r=!0;if(t&&t.length>0)for(var c=0;c<t.length;c++)t[c].userName!=i.userName&&t[c].userPhone!=i.userPhone||(r=!1);r&&t.push(i),this.setData({signMans:t,linkMans:a}),e.setStorageSync("signMans",t),this.ishighLightFun()}},onReady:function(){},onShow:function(){},onHide:function(){e.removeStorageSync("companySign"),e.removeStorageSync("personSign"),e.removeStorageSync("personLink"),e.removeStorageSync("companyLink")},onUnload:function(){e.removeStorageSync("signMans"),e.removeStorageSync("linkMans")},onPullDownRefresh:function(){},onReachBottom:function(){},onShareAppMessage:function(){},methods:{checkAuthFun:function(e){var n=e.type,t=e.companyName,s=e.name,i=e.phone,r=e.callback,c=new Promise((function(e,n){(0,a.get)({url:o.company_message,params:{companyName:t},success:function(n){e(n)}})})),u=new Promise((function(e,n){(0,a.get)({url:o.person_message,params:{name:s,phone:i},success:function(n){e(n)}})})),l=1==n?[u]:[u,c];Promise.all(l).then((function(e){console.log(e,222),"function"==typeof r&&(1==n?r(1==e):r(1==e[0],1==e[1]))}))},ishighLightFun:function(e){var n=this;n.signMans.length>0?n.setData({ishighLight:!0}):n.setData({ishighLight:!1}),setTimeout((function(){n.ishighLightFun()}),1e3)},formatTimeConvert:function(e,n){e+="",e=10==e.length?1e3*e:e;var t=new Date(Number(e)),a=t.getFullYear(),s=t.getMonth()+1;s=s<10?"0"+s:s;var o=t.getDate();o=o<10?"0"+o:o;var i=t.getHours();i=i<10?"0"+i:i;var r=t.getMinutes(),c=t.getSeconds();return r=r<10?"0"+r:r,c=c<10?"0"+c:c,0==n?a+"-"+s+"-"+o:a+"-"+s+"-"+o+" "+i+":"+r+":"+c},getDetailDataFun:function(e){var n=this;(0,a.get)({url:s.get_contract_detail,params:{id:e},success:function(e){console.log(e);var t=[],a=[];console.log(n.formatTimeConvert(e.contractSubject.signingDeadline,0),"asdadadasdasd"),n.setData({signingDeadline:e.contractSubject.signingDeadline?n.formatTimeConvert(e.contractSubject.signingDeadline,0):"",fileTermination:e.contractSubject.fileTermination?n.formatTimeConvert(e.contractSubject.fileTermination,0):""}),e.contractFlowTasks.map((function(e){2==e.processType&&(1==e.relationType&&n.checkAuthFun({type:1,name:e.userName,phone:e.userPhone,callback:function(a){var s={userName:e.userName,userPhone:e.userPhone,processType:e.processType,sealName:n.getSealNameFun(e.sealType.split(",")),sealType:e.sealType,relationType:e.relationType,status:e.status,isPersonAuth:a};t.push(s)}}),2==e.relationType&&n.checkAuthFun({type:2,companyName:e.companyName,name:e.userName,phone:e.userPhone,callback:function(a,s){console.log(s,a);var o={companyName:e.companyName,userName:e.userName,userPhone:e.userPhone,processType:e.processType,sealName:n.getSealNameFun(e.sealType.split(",")),sealType:e.sealType,relationType:e.relationType,status:e.status,isPersonAuth:a,isCompanyAuth:s};t.push(o)}})),4==e.processType&&(1==e.relationType&&n.checkAuthFun({type:1,name:e.userName,phone:e.userPhone,callback:function(t){var s={userName:e.userName,userPhone:e.userPhone,processType:e.processType,sealName:n.getSealNameFun(e.sealType.split(",")),sealType:e.sealType,relationType:e.relationType,status:e.status,isPersonAuth:t};a.push(s)}}),2==e.relationType&&n.checkAuthFun({type:2,companyName:e.companyName,name:e.userName,phone:e.userPhone,callback:function(t,s){console.log("company, ",t,s);var o={companyName:e.companyName,userName:e.userName,userPhone:e.userPhone,processType:e.processType,sealName:n.getSealNameFun(e.sealType.split(",")),sealType:e.sealType,relationType:e.relationType,status:e.status,isPersonAuth:t,isCompanyAuth:s};a.push(o)}}))})),setTimeout((function(){n.setData({signMans:t,linkMans:a}),n.ishighLightFun()}),300)},fail:function(e){console.log(e)}})},getSealNameFun:function(e){var n="";return e.forEach((function(e){switch(e){case"1":n+=""==n?"手绘章":",手绘章";break;case"2":n+=""==n?"企业章":",企业章";break;case"3":n+=""==n?"法人代表章":",法人代表章";break;case"4":n+=""==n?"模版章":",模版章";break;default:break}})),n},companySign:function(){e.navigateTo({url:"/pages/contract/sign/next/companySign/companySign"})},personSign:function(){e.navigateTo({url:"/pages/contract/sign/next/personSign/personSign"})},companyLink:function(){e.navigateTo({url:"/pages/contract/sign/next/companyLink/companyLink"})},personLink:function(){e.navigateTo({url:"/pages/contract/sign/next/personLink/personLink"})},bindDateChange1:function(e){this.setData({signingDeadline:e.detail.value})},bindDateChange2:function(e){this.setData({fileTermination:e.detail.value})},back:function(){var n=this,t=this.signMans,o=this.linkMans;t=t.concat(o);var i=e.getStorageSync("contractData");e.showLoading({title:"加载中"}),(0,a.postBody)({url:s.get_contract_launch,params:{contractSubject:{contractTitle:i.contractTitle,fileTermination:n.fileTermination,signingDeadline:n.signingDeadline,userOrder:n.userOrder,status:5,id:this.contractId},contractFiles:[{fileName:i.fileName,filePath:i.url,coverUrl:i.coverUrl}],contractFlowTasks:t},success:function(n){console.log(n),e.hideLoading({}),setTimeout((function(){e.showToast({title:"保存成功",icon:"success",duration:2e3})}),50),e.reLaunch({url:"/pages/contract/contractList/contract?searchType=8&pageTitle=草稿箱"})},fail:function(n){e.hideLoading(),setTimeout((function(){e.showToast({title:n,icon:"none",duration:2e3})}),50)}})},dragStart:function(n){var t=this,a=t.copyItem,s=n.currentTarget.dataset.index,o=e.createSelectorQuery();a.index=n.currentTarget.dataset.index,a.companyName=this.signMans[s].companyName,a.userName=this.signMans[s].userName,a.userPhone=this.signMans[s].userPhone,a.sealName=this.signMans[s].sealName,a.isPersonAuth=this.signMans[s].isPersonAuth,a.relationType=this.signMans[s].relationType,this.setData({startX:n.changedTouches[0].clientX,startY:n.changedTouches[0].clientY}),o.select(".listbox").boundingClientRect((function(e){a.top=n.changedTouches[0].clientY-e.top-30,t.setData({copyItem:a})})).exec()},dragMove:function(n){var t=this,a=e.createSelectorQuery(),s=t.copyItem;a.select(".listbox").boundingClientRect((function(e){s.top=n.changedTouches[0].clientY-e.top-30,(s.top<-60||s.top>e.height)&&(s.top=-60),t.setData({copyItem:s,showCopy:!0})})).exec()},dragEnd:function(n){var t=this,a=this,s=n.currentTarget.dataset.index,o=e.createSelectorQuery(),i=a.copyItem,r=a.signMans;console.log(r),"delete"==n.target.dataset.type?this.deleteSign(n):(Math.abs(n.changedTouches[0].clientY-this.startY)>10||Math.abs(n.changedTouches[0].clientX-this.startX)>10)&&"delete"!=n.target.dataset.type&&o.select(".listbox").boundingClientRect((function(e){i.top=n.changedTouches[0].clientY-e.top-30,(i.top<-60||n.changedTouches[0].clientY>e.height)&&(i.top=-60);var t=parseInt(i.top/60),o=a.replace;t>=0&&(o.companyName=r[t].companyName,o.userPhone=r[t].userPhone,o.userName=r[t].userName,o.chapter=r[t].chapter,o.personAuth=r[t].personAuth,o.companyAuth=r[t].companyAuth,o.signType=r[t].signType,o.relationType=r[t].relationType,r[t].companyName=r[s].companyName,r[t].userPhone=r[s].userPhone,r[t].userName=r[s].userName,r[t].personAuth=r[s].personAuth,r[t].chapter=r[s].chapter,r[t].companyAuth=r[s].companyAuth,r[t].signType=r[s].signType,r[t].relationType=r[s].relationType,r[s].companyName=o.companyName,r[s].userName=o.userName,r[s].userPhone=o.userPhone,r[s].chapter=o.chapter,r[s].personAuth=o.personAuth,r[s].companyAuth=o.companyAuth,r[s].signType=o.signType,r[s].relationType=o.relationType),a.setData({signMans:r})})).exec(),setTimeout((function(){t.setData({showCopy:!1})}),20)},switchChange:function(e){console.log(e.detail.value),this.setData({isSort:e.detail.value}),this.isSort?this.setData({userOrder:1}):this.setData({userOrder:0})},deleteSign:function(n){var t=n.currentTarget.dataset.index,a=JSON.parse(JSON.stringify(this.signMans));a.splice(t,1),this.setData({signMans:a}),this.signMans.length<2&&this.setData({isSort:!1}),e.setStorageSync("signMans",this.signMans)},deleteLink:function(n){var t=n.currentTarget.dataset.index,a=JSON.parse(JSON.stringify(this.linkMans));a.splice(t,1),this.setData({linkMans:a}),e.setStorageSync("linkMans",this.linkMans)},next:function(n){var t=this,o=this.signMans,i=this.linkMans;o=o.concat(i);var r=e.getStorageSync("contractData");e.showLoading({}),(0,a.postBody)({url:s.get_contract_launch,params:{contractSubject:{contractTitle:r.contractTitle,fileTermination:t.fileTermination,signingDeadline:t.signingDeadline,userOrder:t.userOrder,status:1},contractFiles:[{fileName:r.fileName,filePath:r.url,coverUrl:r.coverUrl}],contractFlowTasks:o},success:function(n){e.hideLoading({}),e.navigateTo({url:"/pages/contract/sign/next/signConfirm/signConfirm?contractId="+n})},fail:function(n){setTimeout((function(){e.showToast({title:n,icon:"none"})}),50)}})},onInput:function(e){this.setData({currentDate:e.detail})}}};n.default=c}).call(this,t("c11b")["default"])},f552:function(e,n,t){"use strict";t.r(n);var a=t("db5d"),s=t.n(a);for(var o in a)"default"!==o&&function(e){t.d(n,e,(function(){return a[e]}))}(o);n["default"]=s.a},f628:function(e,n,t){"use strict";var a=t("67ac"),s=t.n(a);s.a}},[["3e6e","common/runtime","common/vendor"]]]);