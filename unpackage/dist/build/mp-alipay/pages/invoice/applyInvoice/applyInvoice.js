(my["webpackJsonp"]=my["webpackJsonp"]||[]).push([["pages/invoice/applyInvoice/applyInvoice"],{1016:function(e,t,n){"use strict";(function(e){n("e09c");i(n("66fd"));var t=i(n("84b6"));function i(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,n("c11b")["createPage"])},"3c6e":function(e,t,n){"use strict";var i;n.d(t,"b",(function(){return o})),n.d(t,"c",(function(){return a})),n.d(t,"a",(function(){return i}));var o=function(){var e=this,t=e.$createElement;e._self._c},a=[]},"48dc":function(e,t,n){},"6dee":function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n("3b7d"),o=n("f42c");function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var s=n("537e"),u=function(){n.e("components/sliderPicker/sliderPicker").then(function(){return resolve(n("3422"))}.bind(null,n)).catch(n.oe)},l={data:function(){return{operate:1,isDown:!0,checked:"1",checkList:[{label:"个人/非企业单位",value:"1",checked:!0},{label:"企业单位",value:"2"}],invoiceTypeValue:{label:"增值税普通发票",value:"p"},postWayValue:{label:"不推送",value:"-1"},contractTitle:"",id:"",companyInfo:{sellerCompanyName:"",buyerName:"",buyerTaxNo:""},invoiceValue:{buyerAddress:"",buyerPhone:"",buyerBank:"",buyerBankNo:""},postvalue:{pushPhone:"",pushEmail:""},list:[],invoiceType:[{label:"增值税普通发票",value:"p"},{label:"增值税专用发票",value:"s"},{label:"取消",value:"cancle"}],postWay:[{label:"不推送",value:"-1"},{label:"推送到邮箱",value:"0"},{label:"推送到手机",value:"1"},{label:"推送到邮箱和手机",value:"2"},{label:"取消",value:"cancle"}],searchType:"",pageTitle:"",key1:""}},components:{sliderPicker:u},props:{},onLoad:function(t){var n=e.getStorageSync("currentUser");this.setData({contractTitle:t.title,id:t.id,searchType:t.searchType,pageTitle:t.pageTitle}),this.getSellerNameFun(),n&&(this.setData({checked:2,checkList:[{label:"个人/非企业单位",value:"1"},{label:"企业单位",value:"2",checked:!0}]}),this.getInvoiceInfoFun())},onReady:function(){},onShow:function(){},onHide:function(){},onUnload:function(){},onPullDownRefresh:function(){},onReachBottom:function(){},onShareAppMessage:function(){},methods:{handleSelectTypeFun:function(e){this.setData({checked:e.detail.value}),e.detail.value,e.detail.value},handleSelectInvoiceTypeFun:function(){this.setData({operate:1,list:this.invoiceType,isDown:!1}),this.$refs.sliderPicker.show()},handleSelectPostWayFun:function(){this.setData({operate:2,list:this.postWay,isDown:!1}),this.$refs.sliderPicker.show()},handleSelectItemFun:function(e){if(1==this.operate)switch(e.detail){case 0:this.setData({invoiceTypeValue:this.list[0]}),console.log(this.invoiceTypeValue);break;case 1:this.setData({invoiceTypeValue:this.list[1]});break;default:break}if(2==this.operate)switch(e.detail){case 0:this.setData({postWayValue:this.list[0]});break;case 1:this.setData({postWayValue:this.list[1]});break;case 2:this.setData({postWayValue:this.list[2]});break;case 3:this.setData({postWayValue:this.list[3]});break;default:break}this.setData({isDown:!0}),this.$refs.sliderPicker.hide()},getSellerNameFun:function(){var t=this;e.showLoading({title:"加载中"}),(0,i.get)({url:o.get_seller_companyName+"/"+this.id,success:function(e){var n=JSON.parse(JSON.stringify(t.companyInfo));n.sellerCompanyName=e,t.setData({companyInfo:n}),console.log(e)},fail:function(e){console.log(e)},complete:function(){e.hideLoading()}})},getInvoiceInfoFun:function(){var t=this;e.showLoading({title:"加载中"}),(0,i.get)({url:o.get_invouce_info,success:function(e){if(e){var n=JSON.parse(JSON.stringify(t.companyInfo)),i=JSON.parse(JSON.stringify(t.invoiceValue));i.buyerAddress=e.address,i.buyerPhone=e.phone,i.buyerBank=e.bank,i.buyerBankNo=e.bankNo,n.buyerName=e.companyName,n.buyerTaxNo=e.taxNo,t.setData({invoiceValue:i,companyInfo:n})}},fail:function(e){console.log(e)},complete:function(){e.hideLoading()}})},changeInputValueFun:function(e){var t=e.currentTarget.dataset.key1,n=e.currentTarget.dataset.key2,i=JSON.parse(JSON.stringify(this[t]));i[n]=e.detail.value,this.setData(a({},t,i))},handleConfirmFun:function(){var t=this;e.showLoading({title:"加载中"});var n={contractSubjectId:this.id,sellerCompanyName:this.companyInfo.sellerCompanyName,pushMode:this.postWayValue.value};if(2==this.checked){if(!this.companyInfo.buyerName)return setTimeout((function(){e.showToast({icon:"none",title:"请填写发票企业名称"})}),50),!1;if(!this.companyInfo.buyerTaxNo)return setTimeout((function(){e.showToast({icon:"none",title:"请填写纳税人识别号"})}),50),!1;n.buyerName=this.companyInfo.buyerName,n.buyerTaxNo=this.companyInfo.buyerTaxNo}if("s"==this.invoiceTypeValue.value){if(!this.invoiceValue.buyerAddress)return setTimeout((function(){e.showToast({icon:"none",title:"请填写收票方地址"})}),50),!1;if(!this.invoiceValue.buyerPhone)return setTimeout((function(){e.showToast({icon:"none",title:"请填写收票方电话"})}),50),!1;if(!this.invoiceValue.buyerBank)return setTimeout((function(){e.showToast({icon:"none",title:"请填写收票方开户行"})}),50),!1;if(!this.invoiceValue.buyerBankNo)return setTimeout((function(){e.showToast({icon:"none",title:"请填写收票方开户行账号"})}),50),!1;n.buyerAddress=this.invoiceValue.buyerAddress,n.buyerPhone=this.invoiceValue.buyerPhone,n.buyerBank=this.invoiceValue.buyerBank,n.buyerBankNo=this.invoiceValue.buyerBankNo}if(0==this.postWayValue.value){if(!this.postvalue.pushEmail)return setTimeout((function(){e.showToast({icon:"none",title:"请填写推送邮箱"})}),50),!1;n.pushEmail=this.postvalue.pushEmail}if(1==this.postWayValue.value){if(!this.postvalue.pushPhone)return setTimeout((function(){e.showToast({icon:"none",title:"请填写推送手机号"})}),50),!1;if(!s.isTelCode(this.postvalue.pushPhone))return setTimeout((function(){e.showToast({icon:"none",title:"请填写正确的推送手机号"})}),50),!1;n.pushPhone=this.postvalue.pushPhone}if(2==this.postWayValue.value){if(!this.postvalue.pushEmail)return setTimeout((function(){e.showToast({icon:"none",title:"请填写推送邮箱"})}),50),!1;if(!this.postvalue.pushPhone)return setTimeout((function(){e.showToast({icon:"none",title:"请填写推送手机号"})}),50),!1;if(!s.isTelCode(this.postvalue.pushPhone))return setTimeout((function(){e.showToast({icon:"none",title:"请填写正确的推送手机号"})}),50),!1;n.pushEmail=this.postvalue.pushEmail,n.pushPhone=this.postvalue.pushPhone}(0,i.postBody)({url:o.apply_invoice,params:n,success:function(n){console.log(n),setTimeout((function(){e.showToast({icon:"none",title:"申请成功"})}),50),setTimeout((function(){e.redirectTo({url:"/pages/contract/contractList/contract?searchType="+t.searchType+"&pageTitle="+t.pageTitle})}),1e3)},fail:function(t){setTimeout((function(){e.showToast({icon:"none",title:t})}),50)},complete:function(){e.hideLoading()}})}}};t.default=l}).call(this,n("c11b")["default"])},"84b6":function(e,t,n){"use strict";n.r(t);var i=n("3c6e"),o=n("af79");for(var a in o)"default"!==a&&function(e){n.d(t,e,(function(){return o[e]}))}(a);n("c4aa");var s,u=n("f0c5"),l=Object(u["a"])(o["default"],i["b"],i["c"],!1,null,null,null,!1,i["a"],s);t["default"]=l.exports},af79:function(e,t,n){"use strict";n.r(t);var i=n("6dee"),o=n.n(i);for(var a in i)"default"!==a&&function(e){n.d(t,e,(function(){return i[e]}))}(a);t["default"]=o.a},c4aa:function(e,t,n){"use strict";var i=n("48dc"),o=n.n(i);o.a}},[["1016","common/runtime","common/vendor"]]]);