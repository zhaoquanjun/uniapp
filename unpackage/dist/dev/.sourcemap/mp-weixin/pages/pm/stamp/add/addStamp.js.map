{"version":3,"sources":["uni-app:///main.js","webpack:////Users/icourt/Desktop/mycode/uni/pages/pm/stamp/add/addStamp.vue?c921","webpack:////Users/icourt/Desktop/mycode/uni/pages/pm/stamp/add/addStamp.vue?80aa","webpack:////Users/icourt/Desktop/mycode/uni/pages/pm/stamp/add/addStamp.vue?1e0e","webpack:////Users/icourt/Desktop/mycode/uni/pages/pm/stamp/add/addStamp.vue?3a7a","uni-app:///pages/pm/stamp/add/addStamp.vue","webpack:////Users/icourt/Desktop/mycode/uni/pages/pm/stamp/add/addStamp.vue?0ca2","webpack:////Users/icourt/Desktop/mycode/uni/pages/pm/stamp/add/addStamp.vue?8444"],"names":["createPage","Page"],"mappings":";;;;;;;;;;kDAAA;AACA;AACA,yG;AACAA,UAAU,CAACC,iBAAD,CAAV,C;;;;;;;;;;;;;ACHA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAqH;AACrH;AAC4D;AACL;AACa;;;AAGpE;AACsN;AACtN,gBAAgB,iNAAU;AAC1B,EAAE,8EAAM;AACR,EAAE,mFAAM;AACR,EAAE,4FAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,uFAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACvBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACRA;AAAA;AAAA;AAAA;AAAo2B,CAAgB,syBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACiCx3B;AACA,mE;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AACA,mB,eAEA,EACA,IADA,kBACA,CACA,SACA,YADA,EAEA,aAFA,EAGA,QAHA,EAIA,kBAJA,GAMA,CARA,EAUA,cAVA,EAWA,SAXA,EAYA,2BACA,wBACA,gBACA,YADA,EAEA,eAFA,IAIA,CALA,EAKA,EALA,EAMA,CAnBA,EAqBA;;+QAGA,mCAxBA,EA0BA,iBA1BA,+BA0BA,EA1BA,EA4BA,WACA,0DACA,iDACA,CAHA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uCAPA,CAOA;;AAEA;AACA,KAfA;AAgBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8BARA,CAQA;AACA;AACA;AACA;AACA;AACA;AACA,KA/BA;AAgCA;AACA;AACA;AACA;AACA,gBADA;;AAGA,KAtCA;;AAwCA;AACA;AACA;AACA;AACA,oBADA;;AAGA,KA9CA;AA+CA;AACA;AACA;AACA;AACA,KAnDA;AAoDA;AACA;AACA;AACA;AACA;AACA;AACA,iCADA;AAEA;AACA,cAHA;AAIA,cAJA;AAKA,sBALA;AAMA,wBANA;;AAQA,iBARA,mBAQA,GARA,EAQA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oCADA;AAEA,oBAFA;AAGA,oBAHA;AAIA,6BAJA;AAKA,6BALA;AAMA;AACA;AACA,6BADA;AAEA,8BAFA;;AAIA;AACA,oDADA;AAEA,8CAFA;AAGA,+BAHA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0CADA;AAEA,0DAFA;;AAIA;AACA,sDADA;AAEA,sCAFA;AAGA;AACA,sCADA;AAEA,yCAFA;AAGA,yCAHA,EAHA;;AAQA;AACA,yCADA,CACA;AACA;AACA;;AAEA;AACA;AACA,6DADA;;AAGA,yBAjBA;AAkBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6DADA;;AAGA,yBA3BA;;AA6BA,qBA3CA;AA4CA;AACA;AACA;AACA,qBA/CA;;AAiDA,iBA5DA;;AA8DA,aA/DA;AAgEA,WAnFA;;AAqFA,cArFA,gBAqFA,CArFA,EAqFA;AACA;AACA,WAvFA;;;AA0FA,OA7FA,EA6FA,IA7FA;AA8FA,KApJA,EA5BA,E;;;;;;;;;;;;;ACrCA;AAAA;AAAA;AAAA;AAA6tC,CAAgB,mmCAAG,EAAC,C;;;;;;;;;;;ACAjvC;AACA,OAAO,KAAU,EAAE,kBAKd","file":"pages/pm/stamp/add/addStamp.js","sourcesContent":["import 'uni-pages';\nimport Vue from 'vue'\nimport Page from './pages/pm/stamp/add/addStamp.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./addStamp.vue?vue&type=template&id=e08fa076&\"\nvar renderjs\nimport script from \"./addStamp.vue?vue&type=script&lang=js&\"\nexport * from \"./addStamp.vue?vue&type=script&lang=js&\"\nimport style0 from \"./addStamp.vue?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/pm/stamp/add/addStamp.vue\"\nexport default component.exports","export * from \"-!../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--16-0!../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./addStamp.vue?vue&type=template&id=e08fa076&\"","var components\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./addStamp.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./addStamp.vue?vue&type=script&lang=js&\"","<template>\r\n<view>\r\n<!--pages/pm/stamp/add/addStamp.wxml-->\r\n<canvas canvas-id=\"stampCanvas\" id=\"stampCanvas\" class=\"stamp-canvas\" disable-scroll=\"false\" @touchstart=\"touchStart\" @touchmove=\"touchMove\"> \r\n    <image class=\"watermark\" src=\"/static/pages/pm/stamp/add/watermark.png\"></image>    \r\n</canvas>\r\n<canvas class=\"stamp-canvas copy-canvas\" canvas-id=\"myCanvas\" id=\"myCanvas\" style=\"z-index: -11; opacity: 0; visiblity: hidden;\"></canvas>\r\n<view class=\"operation-btn-view\">\r\n    <view :class=\"'first-pen-btn pen-btn ' + (color==='#000'?'active':'') + '}'\" data-color=\"#000\" @tap.stop=\"switchColor\">\r\n        <view class=\"one one-dot\" style=\"background-color:#000\"></view>\r\n    </view>\r\n    <view :class=\"'pen-btn ' + (color==='#22ACF8'?'active':'')\" data-color=\"#22ACF8\" @tap.stop=\"switchColor\">\r\n        <view class=\"one one-dot\" style=\"background-color:#22ACF8\"></view>\r\n    </view>\r\n    <view :class=\"'pen-btn ' + (color==='#FE4E51'?'active':'')\" data-color=\"#FE4E51\" @tap.stop=\"switchColor\">\r\n        <view class=\"one one-dot\" style=\"background-color:#FE4E51\"></view>\r\n    </view>\r\n    <view class=\"line\"></view>\r\n    <image src=\"/static/pages/pm/stamp/add/pen.png\" :class=\"'pen-btn pen-size ' + (pen=='4'?'active-pen':'')\" @tap.stop=\"switchPen\" data-pen=\"4\"></image>\r\n    <image src=\"/static/pages/pm/stamp/add/pen1.png\" :class=\"'pen-btn pen-size ' + (pen=='6'?'active-pen':'')\" @tap.stop=\"switchPen\" data-pen=\"6\"></image>\r\n    <image src=\"/static/pages/pm/stamp/add/pen2.png\" :class=\"'pen-btn pen-size ' + (pen=='8'?'active-pen':'')\" @tap.stop=\"switchPen\" data-pen=\"8\"></image>\r\n    <view class=\"clean-btn\" @tap.stop=\"clearAction\">\r\n        <text class=\"clean-text\">清除</text>\r\n    </view>\r\n    <view class=\"submit-btn\" @tap.stop=\"submitAction\">\r\n        <text class=\"submit-text\">提交</text>\r\n    </view>\r\n\r\n</view>\r\n</view>\r\n</template>\r\n\r\n<script>\r\nimport { postBody, upload } from '../../../../api/request.js'\nimport { upload_painted_wx_url, save_personnal_seal } from '../../../../api/seal.js'\r\nconst app = getApp();\r\n\r\nexport default {\r\n  data() {\r\n    return {\r\n      stampUrl: '',\r\n      color: '#000',\r\n      pen: '4',\r\n      penSizeShow: false\r\n    };\r\n  },\r\n\r\n  components: {},\r\n  props: {},\r\n  onShow: function () {\r\n    setTimeout(() => {\r\n      uni.showToast({\r\n        icon: 'none',\r\n        title: '请将手机横屏'\r\n      });\r\n    }, 50);\r\n  },\r\n\r\n  /**\r\n   * 生命周期函数--监听页面加载\r\n   */\r\n  onLoad: function (options) {},\r\n\r\n  onShareAppMessage() {},\r\n\r\n  methods: {\r\n    canvasIdErrorCallback: function (e) {\r\n      console.error('canvas error:' + e.detail.errMsg);\r\n    },\r\n    //手指触摸动作开始\r\n    touchStart: function (e) {\r\n      //得到触摸点的坐标\r\n      this.startX = e.changedTouches[0].x;\r\n      this.startY = e.changedTouches[0].y;\r\n      this.context = uni.createCanvasContext('stampCanvas');\r\n      this.context.setStrokeStyle(this.color);\r\n      this.context.setLineWidth(this.pen);\r\n      this.context.setLineCap('round'); // 让线条圆润\r\n\r\n      this.context.beginPath();\r\n    },\r\n    //手指触摸后移动\r\n    touchMove: function (e) {\r\n      var startX1 = e.changedTouches[0].x;\r\n      var startY1 = e.changedTouches[0].y;\r\n      this.context.moveTo(this.startX, this.startY);\r\n      this.context.lineTo(startX1, startY1);\r\n      this.context.stroke();\r\n      this.startX = startX1;\r\n      this.startY = startY1;\r\n      this.context.draw(true); //只是一个记录方法调用的容器，用于生成记录绘制行为的actions数组。context跟<canvas/>不存在对应关系，一个context生成画布的绘制动作数组可以应用于多个<canvas/>\r\n      // wx.drawCanvas({\r\n      //   canvasId: 'stampCanvas',\r\n      //   reserve: true,\r\n      //   actions: this.context.getActions() // 获取绘图动作数组\r\n      // })\r\n    },\r\n    switchPen: function (e) {\r\n      console.log('切换font');\r\n      var pen = e.currentTarget.dataset.pen;\r\n      this.setData({\r\n        pen: pen\r\n      });\r\n    },\r\n\r\n    switchColor: function (e) {\r\n      console.log('切换color');\r\n      var color = e.currentTarget.dataset.color;\r\n      this.setData({\r\n        color: color\r\n      });\r\n    },\r\n    clearAction: function () {\r\n      console.log('清除');\r\n      this.context.clearRect(0, 0, 750, 1334);\r\n      this.context.draw();\r\n    },\r\n    submitAction: function () {\r\n      const query = uni.createSelectorQuery();\r\n      query.select('#stampCanvas').boundingClientRect(rect => {\r\n        const width = rect.width;\r\n        const height = rect.height;\r\n        uni.canvasToTempFilePath({\r\n          canvasId: 'stampCanvas',\r\n          // fileType:'jpg',\r\n          x: 0,\r\n          y: 0,\r\n          width: width,\r\n          height: height,\r\n\r\n          success(res) {\r\n            var tempFilePath = res.tempFilePath;\r\n            console.log(tempFilePath);\r\n            const ctx = uni.createCanvasContext('myCanvas');\r\n            ctx.fillStyle = '#fff';\r\n            ctx.fillRect(0, 0, width, height);\r\n            const ratio = width / height;\r\n            ctx.rotate(-90 * Math.PI / 180);\r\n            ctx.scale(ratio, ratio);\r\n            ctx.translate(-width * 1.5, 0);\r\n            ctx.drawImage(tempFilePath, 0, 0, width, height);\r\n            ctx.draw(true, () => {\r\n              uni.canvasToTempFilePath({\r\n                canvasId: 'myCanvas',\r\n                x: 0,\r\n                y: 0,\r\n                width: height,\r\n                height: width,\r\n                success: res => {\r\n                  uni.showLoading({\r\n                    title: '',\r\n                    mask: true\r\n                  });\r\n                  upload({\r\n                    url: upload_painted_wx_url,\r\n                    filePath: res.tempFilePath,\r\n                    key: 'file',\r\n                    // formData: {\r\n                    //   \"\":sfg,\r\n                    // },\r\n                    success: function (data) {\r\n                      console.log(data);\r\n                      var userToken = app.globalData.getUserToken();\r\n                      var header = {\r\n                        \"token\": userToken,\r\n                        \"Content-Type\": \"application/json\"\r\n                      };\r\n                      postBody({\r\n                        url: save_personnal_seal,\r\n                        header: header,\r\n                        params: {\r\n                          \"name\": \"印章\",\r\n                          \"url\": data.url,\r\n                          \"originType\": 1\r\n                        },\r\n                        success: function (e) {\r\n                          console.log(e); // var dataArray = _this.data.stampArray;\r\n                          // dataArray.splice(index, 1);\r\n                          // _this.updateData(dataArray);\r\n\r\n                          uni.hideLoading();\r\n                          uni.navigateBack({\r\n                            delta: getCurrentPages.length - 1\r\n                          });\r\n                        },\r\n                        fail: function (err) {\r\n                          // wx.showToast({\r\n                          //   icon: 'none',\r\n                          //   title: err\r\n                          // })\r\n                          uni.hideLoading();\r\n                          uni.navigateBack({\r\n                            delta: getCurrentPages.length - 1\r\n                          });\r\n                        }\r\n                      });\r\n                    },\r\n                    fail: function (msg) {\r\n                      console.log(msg);\r\n                      uni.hideLoading();\r\n                    }\r\n                  });\r\n                }\r\n              });\r\n            });\r\n          },\r\n\r\n          fail(e) {\r\n            console.log(e);\r\n          }\r\n\r\n        });\r\n      }).exec();\r\n    }\r\n  }\r\n};\r\n</script>\r\n<style>\r\n@import \"./addStamp.css\";\r\n</style>","import mod from \"-!../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./addStamp.vue?vue&type=style&index=0&lang=css&\"; export default mod; export * from \"-!../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./addStamp.vue?vue&type=style&index=0&lang=css&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1609985897650\n      var cssReload = require(\"/Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"../../\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}